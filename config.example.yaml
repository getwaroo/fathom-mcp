# file-knowledge-mcp configuration

# Required: path to documents
knowledge:
  root: "./documents"

# Optional: server settings
server:
  name: "file-knowledge-mcp"
  log_level: "INFO"  # DEBUG | INFO | WARNING | ERROR

# Optional: search settings
search:
  context_lines: 5
  max_results: 50
  timeout_seconds: 30

# Optional: exclude patterns
exclude:
  patterns:
    - ".git/*"
    - "__pycache__/*"
    - "*.draft.*"
  hidden_files: true

# Optional: format settings
formats:
  pdf:
    enabled: true
    filter: "pdftotext - -"
    extensions: [".pdf"]
  markdown:
    enabled: true
    filter: null
    extensions: [".md", ".markdown"]
  text:
    enabled: true
    filter: null
    extensions: [".txt", ".rst"]

# Optional: limits
limits:
  max_concurrent_searches: 4
  max_document_read_chars: 100000

# Optional: performance settings (Phase 2 enhancements)
performance:
  # File indexing for faster searches on large collections
  enable_indexing: false               # Enable document indexing
  index_update_strategy: "auto"        # auto | manual | scheduled
  index_formats: [".pdf", ".md", ".txt"]  # File formats to include in index
  index_path: ".fkm_index"             # Index storage path (relative to knowledge root)
  rebuild_index_on_startup: false      # Rebuild index when server starts

  # File watching for automatic index updates
  enable_file_watching: false          # Monitor file changes for auto-updates

  # Caching with file modification tracking
  enable_smart_cache: true             # Enable file mtime tracking in cache
  cache_ttl_seconds: 300               # Cache time-to-live (5 minutes)
  cache_max_size: 100                  # Maximum cached entries

  # Parallel PDF processing
  enable_parallel_pdf: true            # Process PDF pages in parallel
  max_pdf_workers: 4                   # Maximum parallel workers for PDFs

# Optional: security settings (Phase 1 enhancements)
security:
  # Filter command security
  enable_shell_filters: true
  filter_security_mode: "whitelist"  # whitelist | blacklist | disabled

  # Whitelist of allowed filter commands
  # Add full paths or command names that should be allowed
  allowed_filter_commands:
    - "pdftotext"
    - "pdftotext - -"
    - "pandoc"
    - "/usr/bin/pdftotext"
    - "/usr/local/bin/pdftotext"
    - "/opt/homebrew/bin/pdftotext"
    # Add your custom filter commands here

  # Blacklist (only used when filter_security_mode is "blacklist")
  blocked_filter_commands: []

  # Sandboxing and limits
  sandbox_filters: true           # Run filters in restricted environment
  filter_timeout_seconds: 30      # Timeout for filter execution
  max_filter_memory_mb: 512       # Memory limit (platform-dependent)

  # Path security
  restrict_to_knowledge_root: true  # Prevent path traversal attacks
  follow_symlinks: false            # Disallow following symbolic links

# Environment variable overrides:
# All settings can be overridden using environment variables with FKM_ prefix
# Examples:
#   FKM_KNOWLEDGE__ROOT=/path/to/docs
#   FKM_SECURITY__ENABLE_SHELL_FILTERS=false
#   FKM_SECURITY__FILTER_SECURITY_MODE=disabled
#   FKM_SEARCH__MAX_RESULTS=100
#   FKM_PERFORMANCE__ENABLE_INDEXING=true
#   FKM_PERFORMANCE__ENABLE_FILE_WATCHING=true
#   FKM_PERFORMANCE__ENABLE_PARALLEL_PDF=false
